<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grafo MetabÃ³lico 3D</title>

    <link rel="stylesheet" href="{{ url_for('static', filename='css/grafo.css') }}">

    <script src="https://unpkg.com/three@0.160.0/build/three.min.js"></script>
    <script src="https://unpkg.com/3d-force-graph"></script>

    <!-- Choices.js CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css" />

    <!-- Choices.js JS -->
    <script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>

</head>

<body data-run-id="{{ run_id }}">

    <!-- BotÃ³n flotante para ocultar/mostrar panel -->
    <button id="btnToggleTools">ðŸ§° Tools</button>
    <button id="btnRegresar" class="btn-regresar">â¬… Back</button>

    <!-- ===============================
         PANEL LATERAL COMPLETO
    ================================ -->
    <div id="side-panel">

        <div class="panel-section">
            <label for="selectorSubsistema" class="panel-title">Subsistem:</label>
            <select id="selectorSubsistema">
                <option value="">â€” All â€”</option>
            </select>
        </div>

        <div class="panel-section">
            <button id="btnNombres">Names: ON</button>
        </div>

        <div class="panel-section">
            <div class="legend-title">Flux (Heatmap)</div>
            <canvas id="legendCanvas" width="200" height="20"></canvas>

            <div id="legend-values">
                <span id="legend-min">0</span>
                <span style="flex:1;"></span>
                <span id="legend-max">0</span>
            </div>
        </div>

        <div class="panel-section">
            <label class="panel-title">Display threshold:</label>
            <input type="range" id="sliderThreshold" min="0" max="1" step="0.01" value="0">
            <span id="valorThreshold">0%</span>
        </div>

        <div class="panel-section info-section">
            <div id="info-box">Click on a node to view details.</div>
        </div>

    </div>

    <!-- Contenedor del grafo -->
    <div id="graph"></div>

    <script>
        // Cuando el usuario navegue fuera del grafo, pedir reset en index
        window.onbeforeunload = () => {
            sessionStorage.setItem("resetUI", "1");
        };
    </script>


    <script src="{{ url_for('static', filename='js/grafo.js') }}"></script>
</body>
</html>
