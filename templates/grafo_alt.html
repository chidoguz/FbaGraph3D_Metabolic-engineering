<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Metabolic Graph s x s</title>

    <!-- Estilos -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/grafo_alt.css') }}">

    <!-- LibrerÃ­as -->
    <script src="https://unpkg.com/three@0.160.0/build/three.min.js"></script>
    <script src="https://unpkg.com/3d-force-graph"></script>

    <!-- Plotly para la matriz subsistemaÃ—subsistema -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

</head>

<body data-run-id="{{ run_id }}">

    <!-- ============================================
         BOTÃ“N PARA MOSTRAR/OCULTAR PANEL
    ============================================= -->
    <button id="btnToggleTools">ðŸ§° Tools</button>
    <button id="btnRegresar" class="btn-regresar">â¬… Back</button>

    <!-- ============================================
         PANEL LATERAL COMPLETO (HERRAMIENTAS)
    ============================================= -->
    <div id="side-panel">

        <!-- SUBSISTEMAS (solo info, no filtrar) -->
        <div class="panel-section">
            <h3 class="panel-title">Subsystems found</h3>
            <div id="subsistemaList" class="subsystem-list">
                Loading...
            </div>
        </div>

        <!-- LEYENDA DEL HEATMAP -->
        <div class="panel-section">
            <div class="legend-title">Metabolic activity (max flux)</div>
            <canvas id="legendCanvas" width="220" height="20"></canvas>

            <div id="legend-values">
                <span id="legend-min">0</span>
                <span style="flex:1;"></span>
                <span id="legend-max">0</span>
            </div>
        </div>

        <!-- UMBRAL ACTIVIDAD -->
        <div class="panel-section">
            <label class="panel-title">Activity threshold:</label>
            <input type="range" id="sliderThreshold" min="0" max="1" step="0.01" value="0">
            <span id="valorThreshold">0.00</span>
        </div>

        <!-- INFO NODO -->
        <div class="panel-section info-section">
            <div id="info-box">Click on a node to view details.</div>
        </div>

        <button id="btnDescargarMatrizAlt" class="btn-down">
            Download matrix s x s
        </button>
    </div>

    <!-- ============================================
         MATRIZ SUBSISTEMA Ã— SUBSISTEMA (SÃ—S)
    ============================================= -->
    <!-- PANEL AJUSTABLE DE MATRIZ -->
<!-- PANEL AJUSTABLE DERECHA (MATRIZ SÃ—S) -->
<div id="matrix-panel" class="expandido">

    <!-- ENCABEZADO DEL PANEL -->
    <div id="matrix-header">
        <span>Metabolic activity (maximum flow)</span>
        <button id="toggleMatrixBtn" class="toggle-open">â®ž</button>
    </div>

    <!-- CONTENEDOR DE LA MATRIZ (PLOTLY) -->
    <div id="matrixContainer" 
        style="width:100%; height:600px; overflow:auto; border-radius:12px;">
        <div id="matrixPlot" style="width:2500px;"></div>
    </div>


    <!-- HANDLE PARA REDIMENSIONAR -->
    <div id="matrix-resizer"></div>
</div>

<!-- BOTÃ“N FLOTANTE PARA MOSTRAR EL PANEL CUANDO ESTÃ OCULTO -->
<button id="matrixShowBtn" style="display:none;">â®œ Ver matriz</button>



    <!-- ============================================
         CONTENEDOR DEL GRAFO 3D
    ============================================= -->
    <div id="graph"></div>

    <!-- JS DEL GRAFO ALT -->
    <script src="{{ url_for('static', filename='js/grafo_alt.js') }}"></script>

</body>
</html>
